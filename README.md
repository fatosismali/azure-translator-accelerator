# Azure AI Translator Solution Accelerator

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

A production-ready solution accelerator for Azure AI Translator Service with Neural Machine Translation (NMT) and LLM-powered translation (GPT-4o/GPT-4o-mini).

## ✨ Features

- 🌍 **137+ Languages** - Translate between all Azure Translator supported languages
- 🤖 **LLM Translation** - GPT-4o/mini powered translation with tone & context control
- ⚖️ **Side-by-Side Compare** - Compare NMT vs LLM translations in real-time
- 📖 **Dictionary Lookup** - Alternative translations with usage examples
- 📦 **Batch Translation** - Process multiple files from Azure Storage
- 🔐 **Secure by Default** - Managed Identity, Key Vault integration
- 📊 **Monitoring** - Application Insights for telemetry and logging

---

## 📋 Prerequisites

- **Azure Subscription** - [Create free account](https://azure.microsoft.com/free/)
- **Azure CLI** - [Install](https://docs.microsoft.com/cli/azure/install-azure-cli) v2.50+
- **Git** - For cloning the repository

---

## 🚀 Quick Start - Deploy to Azure

Deploy your complete solution in 2 simple steps:

### Step 1: Clone Repository

```bash
git clone <your-repo-url>
cd azure-translator-accelerator
```

### Step 2: Login to Azure

```bash
az login
az account set --subscription "<your-subscription-id>"
```

### Step 3: Deploy Infrastructure (10-15 min)

```bash
cd infra/scripts

# Bootstrap Azure resources
# Usage: bash bootstrap.sh <env> <region>
bash bootstrap.sh dev uksouth

# Enter a unique resource prefix when prompted (3-10 characters, lowercase)
# Example: myprefix, acme123, etc.
```

**What gets created:**
- Azure Translator Service (S1 tier)
- AI Foundry Hub with GPT-4o-mini
- Storage Account with containers
- Key Vault for secrets
- App Service Plan with Backend + Frontend apps
- Application Insights for monitoring

**💡 Note**: The script will prompt for a unique resource prefix. This ensures your resources don't conflict with existing ones.

### Step 4: Deploy Application Code (5-10 min)

```bash
# Still in infra/scripts directory
# Usage: bash deploy.sh <env> <prefix> --yes
bash deploy.sh dev myprefix --yes
```

Replace `myprefix` with the same prefix you used in Step 3.

**What this does:**
1. ✅ Retrieves all resource configurations
2. ✅ Stores secrets in Key Vault
3. ✅ Configures managed identities and RBAC
4. ✅ Deploys Python FastAPI backend
5. ✅ Deploys React Vite frontend
6. ✅ Configures CORS and startup commands
7. ✅ Tests endpoints
8. ✅ Creates local `.env` file for development

**Expected Output:**
```bash
✨ Deployment Complete! ✨

🌐 Application URLs:
   Frontend:     https://myprefix-dev-web-xxx.azurewebsites.net
   Backend API:  https://myprefix-dev-api-xxx.azurewebsites.net
   API Docs:     https://myprefix-dev-api-xxx.azurewebsites.net/docs

🔑 Secrets:
   Key Vault:    myprefix-dev-kv-xxx
   All secrets stored and configured via managed identities

📊 Monitoring:
   App Insights: myprefix-dev-ai
```

### Step 5: Test Your Deployment

Wait ~30 seconds for apps to fully start, then:

**Test Backend:**
```bash
curl https://myprefix-dev-api-xxx.azurewebsites.net/health
# Expected: {"status":"healthy","version":"1.0.0",...}
```

**Test Frontend:**

Open your frontend URL in a browser: `https://myprefix-dev-web-xxx.azurewebsites.net`

Try these features:
1. ✅ **Translate Tab** - Translate text between languages
2. ✅ **Compare Tab** - Compare NMT vs LLM translations
3. ✅ **Dictionary Tab** - Look up word definitions
4. ✅ **Batch Tab** - Translate files from storage (after uploading some .txt files)
5. ✅ **Review Tab** - Compare and rate translations

**🎉 Your deployment is complete!**

---

## 🔄 Redeployment

**Redeploy application code only** (infrastructure already exists):
```bash
cd infra/scripts
bash deploy.sh dev myprefix --yes
```

**Redeploy frontend only** (faster, ~2-3 minutes):
```bash
cd infra/scripts
bash deploy-frontend.sh myprefix dev
```

**Update infrastructure** (if you modified Bicep templates):
```bash
cd infra/scripts
bash bootstrap.sh dev uksouth --yes
```

---

## 💻 Local Development (Optional)

To run the app locally while using Azure resources:

### 1. Backend Setup

```bash
cd src/backend

# Install dependencies
pip3 install -r requirements.txt

# Copy .env file generated by deploy.sh from project root
cp ../../.env .env

# Run backend
python3 -m uvicorn app.main:app --reload --port 8000
```

Visit: http://localhost:8000/docs

### 2. Frontend Setup

```bash
cd src/frontend

# Install dependencies
npm install

# Create .env.local
echo "VITE_API_BASE_URL=http://localhost:8000" > .env.local

# Run frontend
npm run dev
```

Visit: http://localhost:5173

---

## 📁 Project Structure

```
├── infra/
│   ├── bicep/                  # Infrastructure as Code
│   │   ├── main.bicep          # Main template
│   │   ├── modules/            # Resource modules
│   │   └── parameters/         # Environment configs
│   └── scripts/
│       ├── bootstrap.sh        # Deploy infrastructure
│       ├── deploy.sh           # Deploy application code
│       └── cleanup.sh          # Delete everything
│
├── src/
│   ├── backend/                # Python FastAPI
│   │   ├── app/
│   │   │   ├── api/            # API routes & models
│   │   │   ├── services/       # Business logic
│   │   │   └── main.py         # Entry point
│   │   └── requirements.txt
│   │
│   └── frontend/               # React + TypeScript
│       ├── src/
│       │   ├── components/     # UI components
│       │   └── services/       # API client
│       └── package.json
│
└── docs/                       # Additional documentation
```

---

## 🔧 Configuration

### Key Environment Variables

Backend uses these (auto-configured by deploy.sh):
```bash
AZURE_TRANSLATOR_KEY=<from-keyvault>
AZURE_TRANSLATOR_REGION=<deployment-region>
AZURE_TRANSLATOR_ENDPOINT=https://api.cognitive.microsofttranslator.com
AZURE_STORAGE_ACCOUNT_NAME=<storage-account-name>
AZURE_AI_FOUNDRY_ENDPOINT=<foundry-endpoint>
AZURE_AI_FOUNDRY_KEY=<from-keyvault>
AZURE_KEY_VAULT_URL=<keyvault-url>
```

Frontend uses:
```bash
VITE_API_BASE_URL=<backend-api-url>
```

**💡 All secrets are stored in Key Vault and accessed via managed identities - no secrets in code!**

---

## 💰 Cost Estimation

### Development Environment
- Azure Translator (S1): **~$10/month** (2M chars included)
- App Service (B1): **~$13/month**
- Storage: **~$0.50/month**
- Application Insights: **~$2/month** (5GB free)
- AI Foundry (GPT-4o-mini): **Pay per use** (~$0.15/1M tokens)

**Total: ~$25-30/month**

### Production Environment
- Translator (S1+): **$10+ per month**
- App Service (P1v3): **~$80/month**
- Storage (GRS): **~$5/month**
- App Insights: **~$10/month**
- AI Foundry: **Pay per use**

**Total: ~$105/month + usage**

---

## 🚨 Troubleshooting

### Batch Tab Shows No Containers

**Cause**: Storage RBAC permissions not configured.

**Solution**: Already handled by `deploy.sh`! If deployed before the fix, run:
```bash
# Get resource names
BACKEND_APP=$(az webapp list --resource-group <rg-name> --query "[?contains(name, 'api')].name | [0]" -o tsv)
STORAGE_NAME=$(az storage account list --resource-group <rg-name> --query "[0].name" -o tsv)

# Remove connection string setting (if exists)
az webapp config appsettings delete --name $BACKEND_APP --resource-group <rg-name> --setting-names "AZURE_STORAGE_CONNECTION_STRING"

# Restart backend
az webapp restart --name $BACKEND_APP --resource-group <rg-name>
```

### Backend Returns 500 Errors

**Check logs:**
```bash
az webapp log tail --name <backend-app-name> --resource-group <resource-group>
```

Common issues:
- Missing environment variables
- Key Vault access not granted
- Translator API key invalid

### Frontend Not Loading

**Check:**
1. Frontend built with correct `VITE_API_BASE_URL`
2. Backend is running and healthy
3. CORS configured correctly (auto-handled by deploy.sh)

**View logs:**
```bash
az webapp log tail --name <frontend-app-name> --resource-group <resource-group>
```

### AI Foundry Deployment Stuck

This happens occasionally. Delete and redeploy:
```bash
# Delete the stuck resource
az cognitiveservices account delete --name <foundry-name> --resource-group <rg-name>

# If soft-deleted, purge it
az cognitiveservices account purge --name <foundry-name> --resource-group <rg-name> --location <region>

# Redeploy infrastructure
cd infra/scripts
bash bootstrap.sh dev uksouth
```

---

## 🧹 Cleanup

To delete all Azure resources:

```bash
cd infra/scripts
bash cleanup.sh dev
```

**⚠️ Warning**: This deletes everything permanently. All data will be lost.

---

## 📚 Additional Resources

- **[Architecture Guide](docs/architecture.md)** - Detailed system design
- **[LLM Translation Guide](docs/llm-translation.md)** - GPT-4o features
- **[Troubleshooting Guide](docs/troubleshooting.md)** - Comprehensive solutions
- **[Azure Translator Docs](https://learn.microsoft.com/azure/ai-services/translator/)** - Official documentation

---

## 🤝 Contributing

Contributions welcome! Please:
1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Submit a pull request

---

## 📄 License

This project is licensed under the MIT License - see [LICENSE](LICENSE) for details.

---

## ❓ Support

- **Issues**: [GitHub Issues](../../issues)
- **Azure Translator**: [Microsoft Q&A](https://learn.microsoft.com/answers/tags/133/azure-translator)
- **Azure Support**: [Azure Support Portal](https://azure.microsoft.com/support/)

---

**Made with ❤️ for the Azure community**
